# Complete System Architecture Diagram

## High-Level System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER'S WEB BROWSER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ React Application (http://localhost:5173)                            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ReplayAttackDemo Component                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ LEFT COLUMN         â”‚ RIGHT COLUMN                     â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Attack Controls     â”‚ Server Logs Panel (Sticky)       â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ 66% width           â”‚ 33% width                        â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚                                  â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Attack Buttons:     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ Duplicate Nonce   â”‚ â”‚ ğŸ‘ï¸ Server Logs ğŸ”„           â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ Sequence Abuse    â”‚ â”‚ (Toggle / Refresh)           â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ Timestamp Manip   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â€¢ Seq Collision     â”‚ â”‚ ğŸš¨ REPLAY_ATTACK_DETECTED    â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚ â”‚    alice â†’ bob               â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Clear Results       â”‚ â”‚    14:32:15 [CRITICAL]       â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ [btn] [btn]         â”‚ â”‚                              â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚ â”‚ âœ… MESSAGE_SENT              â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Results Display:    â”‚ â”‚    bob â†’ alice               â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚    14:32:10 [INFO]           â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Attack 1        â”‚â”‚ â”‚                              â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ âœ… BLOCKED      â”‚â”‚ â”‚ ğŸš¨ REPLAY_ATTACK_DETECTED    â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Details... â†“    â”‚â”‚ â”‚    alice â†’ bob               â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚    14:31:50 [WARNING]        â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚ â”‚                              â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ [Auto-scrolls]              â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Attack 2        â”‚â”‚ â”‚ [Refreshes 2sec]            â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ âœ… BLOCKED      â”‚â”‚ â”‚ [Max 20 entries]            â”‚â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Details... â†“    â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚                              â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚                                  â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Attack 3        â”‚                                    â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ âœ… BLOCKED      â”‚                                    â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â”‚ Details... â†“    â”‚                                    â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚                     â”‚                                  â”‚ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ State Management:                                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ attacks[] - Attack results                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ selectedAttack - Which to expand                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ serverLogs[] - Latest logs from server                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ showLogs - Toggle logs visibility                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ logsLoading - Fetch in progress                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ Effects:                                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ fetchServerLogs() - Runs every 2 seconds                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Demo functions - Each attack scenario                     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ Component Utilities:                                                 â”‚   â”‚
â”‚  â”‚ â€¢ generateRandomNonce() - From crypto.js                            â”‚   â”‚
â”‚  â”‚ â€¢ Other chat components (ChatWindow.jsx, etc.)                       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  HTTP Requests to Backend:                                                  â”‚
â”‚  1. POST /api/messages (with nonce, sequence, timestamp)                    â”‚
â”‚  2. GET /api/logs (every 2 seconds, with JWT token)                         â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NODE.JS SERVER (port 5000)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Express Application                                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ POST /api/messages (Replay Attack Prevention)                        â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 1. Decode JWT token â†’ Get 'alice'                                    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 2. Layer 1: Validate fields                                          â”‚   â”‚
â”‚  â”‚    if (!body.to || !body.nonce || !body.sequence || !body.timestamp) â”‚   â”‚
â”‚  â”‚        â†’ HTTP 400 Bad Request                                         â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 3. Layer 2: Check nonce uniqueness                                   â”‚   â”‚
â”‚  â”‚    Query: Message.findOne({ from: 'alice', to: 'bob', nonce })      â”‚   â”‚
â”‚  â”‚    if (found) â†’ HTTP 400 "Duplicate nonce"                           â”‚   â”‚
â”‚  â”‚              â†’ createLog(REPLAY_ATTACK_DETECTED, CRITICAL)           â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 4. Layer 3: Check sequence monotonicity                              â”‚   â”‚
â”‚  â”‚    Query: Message.findOne({ from: 'alice', to: 'bob' })             â”‚   â”‚
â”‚  â”‚           .sort({ sequenceNumber: -1 })                              â”‚   â”‚
â”‚  â”‚    if (sequence <= lastSequence) â†’ HTTP 400                          â”‚   â”‚
â”‚  â”‚                                â†’ createLog(REPLAY_ATTACK_DETECTED)   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 5. Layer 4: Check timestamp freshness                                â”‚   â”‚
â”‚  â”‚    if (|now - timestamp| > 300 seconds) â†’ HTTP 400                   â”‚   â”‚
â”‚  â”‚                        â†’ createLog(REPLAY_ATTACK_DETECTED, WARNING)  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 6. All layers pass â†’ HTTP 201 Created                                â”‚   â”‚
â”‚  â”‚    Save message with nonce, sequence, timestamp                      â”‚   â”‚
â”‚  â”‚    createLog(MESSAGE_SENT, INFO)                                     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ GET /api/logs (Fetch Audit Trail)                                    â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 1. Verify JWT token in Authorization header                          â”‚   â”‚
â”‚  â”‚    if (!token) â†’ HTTP 401 Unauthorized                               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 2. Query AuditLog collection                                         â”‚   â”‚
â”‚  â”‚    AuditLog.find().sort({ timestamp: -1 }).limit(50)                â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ 3. Return array of log objects                                       â”‚   â”‚
â”‚  â”‚    Each includes: type, severity, username, timestamp, details       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                               â”‚
â”‚  Dependencies:                                                              â”‚
â”‚  â€¢ express - HTTP framework                                                 â”‚
â”‚  â€¢ mongoose - MongoDB driver                                                â”‚
â”‚  â€¢ jwt - Token verification                                                 â”‚
â”‚  â€¢ bcrypt - Password hashing                                                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONGODB DATABASE                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ messages Collection      â”‚   â”‚ auditlogs Collection     â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ _id: ObjectId            â”‚   â”‚ _id: ObjectId            â”‚                â”‚
â”‚  â”‚ from: "alice"            â”‚   â”‚ timestamp: Date          â”‚                â”‚
â”‚  â”‚ to: "bob"                â”‚   â”‚ type: String             â”‚                â”‚
â”‚  â”‚ encryptedSessionKey: ... â”‚   â”‚   â€¢ MESSAGE_SENT         â”‚                â”‚
â”‚  â”‚ ciphertext: ...          â”‚   â”‚   â€¢ REPLAY_ATTACK_...    â”‚                â”‚
â”‚  â”‚ iv: ...                  â”‚   â”‚   â€¢ AUTH_SUCCESS         â”‚                â”‚
â”‚  â”‚ authTag: ...             â”‚   â”‚   â€¢ KEY_FETCH_SUCCESS    â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚ username: "alice"        â”‚                â”‚
â”‚  â”‚ â­ nonce: "4a7d9f..."    â”‚   â”‚ severity: String         â”‚                â”‚
â”‚  â”‚ â­ sequenceNumber: 5     â”‚   â”‚   â€¢ critical             â”‚                â”‚
â”‚  â”‚ â­ timestamp: ISO-Date   â”‚   â”‚   â€¢ warning              â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚   â€¢ info                 â”‚                â”‚
â”‚  â”‚ sharedFile: {...}        â”‚   â”‚ ipAddress: "192.168..."  â”‚                â”‚
â”‚  â”‚ createdAt: Date          â”‚   â”‚ details: String          â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚                          â”‚                â”‚
â”‚  â”‚ Indexes:                 â”‚   â”‚ Indexes:                 â”‚                â”‚
â”‚  â”‚ â€¢ { from, to, nonce }    â”‚   â”‚ â€¢ { type, timestamp }    â”‚                â”‚
â”‚  â”‚ â€¢ { from, to, sequence } â”‚   â”‚                          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ users Collection         â”‚   â”‚ files Collection         â”‚                â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  â”‚ _id: ObjectId            â”‚   â”‚ _id: ObjectId            â”‚                â”‚
â”‚  â”‚ username: "alice"        â”‚   â”‚ fileName: "document"     â”‚                â”‚
â”‚  â”‚ passwordHash: "bcrypt"   â”‚   â”‚ fileSize: 2048000        â”‚                â”‚
â”‚  â”‚ publicKey: { ... }       â”‚   â”‚ fileType: "pdf"          â”‚                â”‚
â”‚  â”‚ createdAt: Date          â”‚   â”‚ from: "alice"            â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚ to: "bob"                â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚ encryptedChunks: [...]   â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚ uploadedAt: Date         â”‚                â”‚
â”‚  â”‚                          â”‚   â”‚                          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Message Flow: Attack Attempt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Eve (Attacker)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Intercepts Alice's message from network
         â”‚    (or reads from own sent message)
         â”‚
         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Eve's Browser                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ message = {                         â”‚
â”‚   to: "bob",                        â”‚
â”‚   nonce: "4a7d9f...",  â† SAME!     â”‚
â”‚   sequenceNumber: 5,    â† SAME!    â”‚
â”‚   timestamp: "2024-01-15T14:32:14Z" â”‚
â”‚ }                                    â”‚
â”‚                                     â”‚
â”‚ POST /api/messages                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               v
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Network (HTTPS)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 v
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Express Server                   â”‚
        â”‚ POST /api/messages               â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                  â”‚
        â”‚ Layer 1: Validate Fields        â”‚
        â”‚ Status: âœ… PASS                 â”‚
        â”‚ (All fields present)            â”‚
        â”‚                                  â”‚
        v                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚ Layer 2: Nonce Uniqueness       â”‚â”‚
        â”‚ Query: Message.findOne({        â”‚â”‚
        â”‚   from: "eve",                  â”‚â”‚
        â”‚   to: "bob",                    â”‚â”‚
        â”‚   nonce: "4a7d9f..."           â”‚â”‚
        â”‚ })                              â”‚â”‚
        â”‚ Result: FOUND! ğŸš¨               â”‚â”‚
        â”‚ Status: âŒ FAIL - Duplicate     â”‚â”‚
        â”‚                                  â”‚â”‚
        v                                  â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
        â”‚ â†’ HTTP 400 Bad Request          â”‚â”‚â”‚
        â”‚ â†’ Response: {                   â”‚â”‚â”‚
        â”‚      error: "Duplicate nonce"   â”‚â”‚â”‚
        â”‚   }                             â”‚â”‚â”‚
        â”‚ â†’ createLog({                   â”‚â”‚â”‚
        â”‚      type: "REPLAY_ATTACK_...   â”‚â”‚â”‚
        â”‚      username: "eve"            â”‚â”‚â”‚
        â”‚      severity: "critical"       â”‚â”‚â”‚
        â”‚      details: "Duplicate..."    â”‚â”‚â”‚
        â”‚   })                            â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                            â”‚â”‚
                        (Return to Eve's browser)
                                            â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
        â”‚ Eve's Browser                    â”‚â”‚â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚â”‚
        â”‚ Receives: HTTP 400               â”‚â”‚â”‚
        â”‚ Attack Result: âŒ BLOCKED        â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚
        â”‚ Message NOT delivered to Bob     â”‚â”‚â”‚
        â”‚ Eve's attack FAILED              â”‚â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
                                            â”‚â”‚
        Meanwhile, in ReplayAttackDemo UI:  â”‚â”‚
                                            â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚ Left Panel:                      â”‚â”‚
        â”‚ Attack 1: Duplicate Nonce        â”‚â”‚
        â”‚ Result: âœ… BLOCKED               â”‚â”‚
        â”‚                                  â”‚â”‚
        v                                  â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚ After 2 seconds:                 â”‚â”‚
        â”‚ Right Panel (Auto-Refresh):      â”‚â”‚
        â”‚                                  â”‚â”‚
        â”‚ ğŸš¨ REPLAY_ATTACK_DETECTED       â”‚â”‚
        â”‚ eve â†’ bob                        â”‚â”‚
        â”‚ 14:32:15 [CRITICAL]              â”‚â”‚
        â”‚                                  â”‚â”‚
        â”‚ Details:                         â”‚â”‚
        â”‚ Duplicate nonce detected         â”‚â”‚
        â”‚ from eve to bob                  â”‚â”‚
        â”‚                                  â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
```

## Message Flow: Legitimate Message

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alice (User) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alice's Browser (ChatWindow)         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ 1. User types: "Hello Bob"          â”‚
â”‚ 2. Client generates:                â”‚
â”‚    â€¢ nonce = 128-bit random         â”‚
â”‚    â€¢ sequence = 7 (next in counter) â”‚
â”‚    â€¢ timestamp = "2024-01-15..."    â”‚
â”‚                                     â”‚
â”‚ message = {                         â”‚
â”‚   to: "bob",                        â”‚
â”‚   text: "Hello Bob",                â”‚
â”‚   encryptedSessionKey: "...",       â”‚
â”‚   ciphertext: "...",                â”‚
â”‚   iv: "...",                        â”‚
â”‚   authTag: "...",                   â”‚
â”‚   nonce: "4b8e2f...",    â† NEW!    â”‚
â”‚   sequenceNumber: 7,      â† NEW!   â”‚
â”‚   timestamp: "2024-01-15T14:33:00Z" â”‚
â”‚ }                                    â”‚
â”‚                                     â”‚
â”‚ POST /api/messages                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               v
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Network (HTTPS)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 v
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Express Server                   â”‚
        â”‚ POST /api/messages               â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                  â”‚
        â”‚ Layer 1: Validate Fields        â”‚
        â”‚ Status: âœ… PASS                 â”‚
        â”‚                                  â”‚
        v                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
        â”‚ Layer 2: Nonce Uniqueness       â”‚â”‚
        â”‚ Query: Message.findOne({        â”‚â”‚
        â”‚   from: "alice",                â”‚â”‚
        â”‚   to: "bob",                    â”‚â”‚
        â”‚   nonce: "4b8e2f..."           â”‚â”‚
        â”‚ })                              â”‚â”‚
        â”‚ Result: NOT FOUND âœ…             â”‚â”‚
        â”‚ Status: âœ… PASS                 â”‚â”‚
        â”‚                                  â”‚â”‚
        v                                  â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
        â”‚ Layer 3: Sequence Monotonicity  â”‚â”‚â”‚
        â”‚ Query: Message.findOne({        â”‚â”‚â”‚
        â”‚   from: "alice",                â”‚â”‚â”‚
        â”‚   to: "bob"                     â”‚â”‚â”‚
        â”‚ }).sort({seq: -1})              â”‚â”‚â”‚
        â”‚ Result: lastSeq = 6             â”‚â”‚â”‚
        â”‚ Check: 7 > 6 ? YES âœ…            â”‚â”‚â”‚
        â”‚ Status: âœ… PASS                 â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚
        v                                  â”‚â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚
        â”‚ Layer 4: Timestamp Freshness    â”‚â”‚â”‚â”‚
        â”‚ now = 2024-01-15T14:33:05Z      â”‚â”‚â”‚â”‚
        â”‚ msg_ts = 2024-01-15T14:33:00Z   â”‚â”‚â”‚â”‚
        â”‚ diff = 5 seconds                â”‚â”‚â”‚â”‚
        â”‚ max_diff = 300 seconds          â”‚â”‚â”‚â”‚
        â”‚ Check: 5 <= 300 ? YES âœ…         â”‚â”‚â”‚â”‚
        â”‚ Status: âœ… PASS                 â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚
        v                                  â”‚â”‚â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚â”‚â”‚
        â”‚ All Layers PASS! âœ…             â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚ â†’ Save Message                  â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚ â†’ HTTP 201 Created              â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚ â†’ createLog({                   â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚      type: "MESSAGE_SENT"       â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚      username: "alice"          â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚      severity: "info"           â”‚â”‚â”‚â”‚â”‚â”‚
        â”‚   })                            â”‚â”‚â”‚â”‚â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â”‚â”‚
                                            â”‚â”‚â”‚â”‚â”‚
                        (Return to Alice's browser)
                                            â”‚â”‚â”‚â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚â”‚â”‚
        â”‚ Alice's Browser                  â”‚â”‚â”‚â”‚â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚â”‚â”‚â”‚
        â”‚ Receives: HTTP 201 Created       â”‚â”‚â”‚â”‚â”‚
        â”‚ Message: âœ… SENT                 â”‚â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚â”‚
        â”‚ Bob's Browser receives message  â”‚â”‚â”‚â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â”‚â”‚
                                            â”‚â”‚â”‚â”‚â”‚
        Meanwhile:                          â”‚â”‚â”‚â”‚â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚â”‚â”‚
        â”‚ ReplayAttackDemo UI Auto-Refreshâ”‚â”‚â”‚â”‚â”‚
        â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚â”‚â”‚â”‚
        â”‚ Fetches GET /api/logs           â”‚â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚â”‚
        â”‚ Right Panel Updates:             â”‚â”‚â”‚â”‚â”‚
        â”‚ âœ… MESSAGE_SENT                 â”‚â”‚â”‚â”‚â”‚
        â”‚ alice â†’ bob                      â”‚â”‚â”‚â”‚â”‚
        â”‚ 14:33:05 [INFO]                  â”‚â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚â”‚
        â”‚ Details:                         â”‚â”‚â”‚â”‚â”‚
        â”‚ Message from alice to bob        â”‚â”‚â”‚â”‚â”‚
        â”‚ accepted (all checks passed)     â”‚â”‚â”‚â”‚â”‚
        â”‚                                  â”‚â”‚â”‚â”‚â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â”‚â”‚
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REPLAY ATTACK PREVENTION                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sender         â”‚         â”‚   Attacker       â”‚
â”‚   (Alice)        â”‚         â”‚   (Eve)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ Generates:                 â”‚ Intercepts:
         â”‚ â€¢ nonce (random)           â”‚ â€¢ nonce (copies)
         â”‚ â€¢ sequence (counter++)     â”‚ â€¢ sequence (copies)
         â”‚ â€¢ timestamp (now)          â”‚ â€¢ timestamp (copies)
         â”‚                            â”‚
         v                            v
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Encryption & Protection                              â”‚
    â”‚ message + nonce + seq + timestamp                    â”‚
    â”‚ Encrypted with AES-256-GCM                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ POST /api/messages         â”‚ POST /api/messages
         â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      v
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Server Receives  â”‚
              â”‚   Both Messages    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                â”‚               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Alice's Msg â”‚   â”‚ Eve's Msg    â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                â”‚
                â”‚                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚  Layer 1: Field Validation    â”‚
         â”‚  Status: âœ… PASS              â”‚
         â”‚  Status: âœ… PASS              â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Layer 2: Nonce â”‚  â”‚ Layer 2: Nonce    â”‚
         â”‚ Uniqueness     â”‚  â”‚ Uniqueness        â”‚
         â”‚ Query: NOT     â”‚  â”‚ Query: FOUND!     â”‚
         â”‚ FOUND âœ…        â”‚  â”‚ DUPLICATE âŒ      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚ Layer 3:      â”‚          â”‚
         â”‚ Sequence      â”‚          â”‚
         â”‚ (7 > 6) âœ…    â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                â”‚                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚ Layer 4:      â”‚          â”‚
         â”‚ Timestamp     â”‚          â”‚
         â”‚ (5 sec) âœ…    â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                â”‚                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ALL PASS âœ…    â”‚                   â”‚ ALL FAIL â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ HTTP 400  â”‚
                â”‚                             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
         â”‚ HTTP 201 Created  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Save Message      â”‚            â”‚ createLog()          â”‚
         â”‚ Deliver to Bob    â”‚            â”‚ REPLAY_ATTACK_DETECT â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ severity: critical   â”‚
                â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
         â”‚ createLog()         â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ MESSAGE_SENT        â”‚              â”‚ MongoDB: Audit â”‚
         â”‚ severity: info      â”‚              â”‚ Log Entry      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ MongoDB: Message    â”‚            â”‚ Frontend Logs  â”‚
         â”‚ Stored with         â”‚            â”‚ Auto-Refresh   â”‚
         â”‚ nonce, seq, ts      â”‚            â”‚ Shows: ğŸš¨      â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ REPLAY_ATTACK  â”‚
                â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Frontend Logs    â”‚
         â”‚ Auto-Refresh     â”‚
         â”‚ Shows: âœ…        â”‚
         â”‚ MESSAGE_SENT     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture ensures:
- âœ… Single successful message delivery (Alice's message)
- âœ… Complete attack prevention (Eve's message blocked)
- âœ… Full audit trail (both attempts logged)
- âœ… Real-time visibility (logs appear in UI within 2-3 seconds)
- âœ… No bypass possible (server-side enforcement)
